魏敬人同学，您好！
欢迎加入技术中心AI研发组。作为入职任务（Ramp-up Task），我们希望你独立完成一个基于标准工程规范的 AI 原生应用开发。这个任务旨在帮助你熟悉团队的开发流程、代码规范以及大模型应用开发实践。

---
项目背景
我们正在探索通过 AI 技术提升客户服务效率，降低人工客服压力。你需要基于阿里云百炼（Bailian）平台，开发一个智能客服智能体。该智能体能够利用知识库进行精准问答，支持联网搜索回答实时性问题，并提供完整的用户交互界面。

---
任务目标
你需要开发一个智能客服Agent，包含以下核心能力：
平台配置（阿里云百炼平台）
1. 知识库搭建：在百炼模型平台上，使用提供的资料搭建知识库
2. 工作流设计：在百炼平台设计RAG检索工作流，开放为API形式供外部调用
项目代码开发（独立工程）
3. 后端服务开发：基于FastAPI框架，通过代码对接百炼工作流API，实现核心问答流程，以及数据的存储与管理
4. 前端界面开发：通过代码实现简易问答交互界面（HTML/CSS/JS 或前端框架）
核心考核点
在当下的开发环境中（Vibe Coding），单纯实现功能非常简单。因此，我们对你的考核重点在于系统构建能力：
考核维度
详细要求
项目结构和代码逻辑
代码需具备高可维护性，前后端分离清晰，具备异步处理能力
生产环境意识
熟悉阿里云百炼平台的使用（知识库、工作流、API调用），服务具备可观测性，清楚每一笔 Token 的去向与成本
数据持久化能力
正确使用PostgreSQL存储问答数据，具备任务ID追踪和日志记录
工程规范
严格遵守 Git Flow 开发流程，通过 Docker 标准容器化交付

---
项目文档：智能客服Agent
项目名称：智能客服Agent (MVP)
截止时间： 2026年2月11日（周三）16:00
交付形式：Merge Request + Demo 演示

---
1. 项目概述 (Overview)
本项目旨在构建一个高可用的智能客服服务。利用阿里云百炼平台的知识库和工作流能力，通过 API 接收用户问题，结合知识库检索与联网搜索，以流式 (Streaming) 方式返回高质量回答，并具备完整的数据存储、历史记录和生产环境监控能力。

---
2. 业务需求 (Product Requirements)
2.1 百炼平台配置
2.1.1 知识库搭建
- 在阿里云百炼平台创建知识库
- 上传提供的知识资料文档（见 知识库资料 文件夹）
- 配置合适的文档切分策略和向量化参数
2.1.2 工作流设计
设计一个RAG问答工作流，需包含以下节点：
- 输入节点：接收用户问题
- 知识库检索节点：从知识库中检索相关内容
- 联网搜索节点：对于实时性问题进行网络搜索
- 大模型节点：综合检索结果生成回答
- 输出节点：返回结构化响应
2.1.3 API发布
- 将工作流发布为API形式
- 记录API端点、App ID等调用信息
2.2 后端接口设计
2.2.1 问答接口
请求格式：
{
  "question": "什么是ap课程？",
  "session_id": "可选，用于关联历史对话"
}
联网搜索逻辑：
- 需根据用户问题内容自动判断是否需要开启联网搜索
- 例如：涉及实时性信息（天气、新闻、股价等）的问题应自动触发联网搜索
响应要求：
- 接口需支持 SSE (Server-Sent Events) 流式响应
- 响应数据需包含：
  - 正文流：Markdown格式的回答内容
  - 检索来源：知识库检索到的相关文档片段
  - 元数据：请求ID、Token消耗、响应耗时等
安全防御：
- 必须包含防御性指令，拒绝非法及不合规的问题请求
- 测试时需提供一次"越狱"防御成功的截图（尝试诱导模型生成无关/违规内容被拒绝）
2.2.2 历史记录接口
历史记录相关接口自行设计，需支持：
- 获取历史问答列表
- 查看问答详情
- 删除历史记录
2.3 数据库设计
使用 PostgreSQL 存储问答数据，表结构自行设计。
设计要求：
- 需要有唯一的请求/任务ID用于追踪
- 需要存储用户问题、AI回答、知识库召回结果等核心信息
- 支持会话管理（可选：多轮对话场景）
- 考虑合适的索引设计以优化查询性能
参考字段（仅供参考，可自行扩展）：
- 请求ID、会话ID
- 问题内容、回答内容
- 知识库召回结果等
- 响应状态、时间戳等
2.4 前端界面需求
注意：前端不是本次任务的主要考核目标，只需实现简易演示页面即可。
基本功能：
- 问答输入框 + 发送按钮
- 回答展示区（支持流式显示）
- 历史问答记录展示

---
3. 技术与工程要求 (Technical Requirements)
3.1 架构规范 (Architecture)
架构要求：
- 框架选择：后端必须使用 FastAPI，全链路采用 async/await 异步编程模式
- 模块化设计：禁止将所有逻辑堆砌在入口文件中，需合理拆分模块（如 routers、services、models 等）
- 前端技术：可使用原生HTML/CSS/JS，或Vue/React等框架
- 项目结构：自行设计合理的目录结构，体现清晰的分层架构
3.2 可观测性 (Observability)
实现结构化日志 (Structured Logging)，每次请求需记录：
- 请求唯一标识（request_id）
- 响应耗时
- 其他关键信息（自行设计）
3.3 容器化交付 (Dockerization)
- 编写 Dockerfile 和 docker-compose.yaml，实现一键启动（后端服务 + PostgreSQL）
- 配置管理：敏感信息（API Key、数据库密码等）严禁硬编码，必须通过环境变量注入
3.4 代码质量
- 提交前需自行通过 Linter 检查，保持代码风格整洁。
- 代码需具备清晰的注释

---
4. 进阶挑战 (Bonus Challenges)
完成以下挑战可作为加分项：
挑战
说明
挑战 A: 多轮对话
基于session_id实现多轮对话上下文记忆
挑战 B: 并发控制
使用信号量 (Semaphore) 限制同时请求大模型的并发数（如限制为5），防止触发上游 API Rate Limit
挑战 C: 缓存优化
对相似问题的回答进行缓存，提升响应速度
挑战 D: 提前交付
在截止日期前完成全部开发需求并提前进行演示

---
5. 交付物清单 (Deliverables)
5.1 必须交付
交付物
说明
源码仓库
包含完整的前后端源代码
百炼配置文档
知识库配置说明、工作流设计截图、API调用信息
Dockerfile & docker-compose.yaml
确保可直接构建运行
数据库初始化脚本
init.sql 或迁移脚本
README.md
必须包含：项目架构说明、启动指南、API文档说明
5.2 测试报告
测试项
要求
功能测试
3个不同类型问题的问答截图（知识库问题、实时性问题、混合问题）
流式体验
API 响应必须是流式的，客户端能看到“打字机”效果的截图
历史记录
历史问答列表和详情页截图
日志规范
控制台日志截图，展示Token消耗和耗时记录

---
6. 建议时间表 (Timeline)
起始日期：2026年2月5日（周四）
阶段
建议时间
关键动作
Day 1
方案设计
环境配置，申请 Key，熟悉百炼平台，搭建知识库与工作流，设计数据库结构，搭建 FastAPI 异步脚手架
Day 2
核心开发
调通百炼 API，实现 SSE 流式输出接口，实现结构化日志埋点
Day 3
核心开发&鲁棒性建设
Day2任务 + 编写 Dockerfile，处理环境变量。尝试完成进阶挑战（并发控制/重试机制）
Day 4
优化与测试
前端开发，完善 README，进行多场景测试与边界条件测试，准备演示脚本
Day 5
Code Review
发起 Merge Request，下午 16:00 进行代码评审与演示

---
7. 验收标准 (Acceptance Criteria)
7.1 可运行性
- Reviewer 拉取代码后，仅需配置环境变量（API Key），执行 docker-compose up 即可启动全部服务且无报错
7.2 功能完整性
- 问答接口能正确返回流式响应
- 回答中能展示知识库检索来源
- 联网搜索功能可用，能回答实时性问题
- 历史记录功能可正常使用
7.3 前端体验
- 界面简洁美观，无明显UI问题
- 流式输出有"打字机"效果
- 加载和错误状态有合理提示
7.4 数据持久化
- 问答记录正确存储到PostgreSQL
- 服务重启后历史数据不丢失
7.5 日志规范
- 控制台能看到包含 request_id、Token 消耗和耗时的规范日志
7.6 Git 规范
- 提交记录清晰，严格遵循 Feature Branch 流程
- 禁止直接 Push 到 Master/Main 分支
8. 联系方式
开发过程中遇到阻塞性问题（如API Key申请、平台权限等）请及时联系团队导师。
祝开发顺利！ 🚀